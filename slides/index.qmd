---
format:
  revealjs:
    theme: [default, custom.scss]
    slide-number: true
    preview-links: auto
    footer: "Dependency Management Workshop"
    transition: slide
    background-transition: fade
    scrollable: true
execute:
  enabled: false
---

::: {style="text-align: center; margin-top: 60px;"}
#### UBC Bioinformatics and Statistics Workshop Series

## Dependency Management using renv and conda in Markdown

Presenter: Jeffrey Tang | jeffrey.tang@hli.ubc.ca

January 14, 2026

![](images/ubc_acknowledgements.png){width="250px"}
:::

---

## Learning Objectives

- Demonstrate renv (R native) for reproducible R package management
- Show practical setup steps for macOS and Windows (side-by-side)
- Demonstrate conda for Python environments and how to use Python inside R (reticulate)

---

## Agenda

1. Why reproducible research matters (bioinformatics context)
2. renv â€” brief demo (R)
3. conda setup (mac / windows side-by-side) + environment.yml
4. conda-lock (FYI)
5. Python + reticulate demo inside the same Quarto/R Markdown
6. Resources & next steps

---

## Why reproducible research?

- Reproducibility crisis in science: inability to reproduce computational analyses
- Analyses depend on exact package versions, system libraries, and environment setup
- Reproducible environments make analyses portable, auditable, and deployable

---

### renv: R-native dependency management

- renv creates an isolated project library and records a lockfile (renv.lock)
- Commands:

```r
# initialize project-local library
renv::init()

# install packages
install.packages(c("ggplot2", "dplyr"))

# snapshot the current library to renv.lock
renv::snapshot()

# restore on a different machine
renv::restore()
```

---

## Quick renv demo (in the demo file)

- Initialize renv
- Install a couple of packages
- Run a small R example (plot/table)
- Snapshot the lockfile

---

### Installing miniforge - macOS | Windows

::: columns
::: {.column width="50%"}
#### macOS

1. We can use the Miniforge3 installers (https://conda-forge.org/download/)
2. Open up a terminal and run: `bash ${HOME}/Downloads/Miniforge3.sh -b -p "${HOME}/miniforge3"`
3. `source "${HOME}/miniforge3/etc/profile.d/conda.sh"`
4. `conda activate`
5. `conda init`
6. Restart terminal and check `conda --version`
7. Check `python --version` 

:::

::: {.column width="50%"}
#### Windows

1. Download Miniforge installer (same as MacOS)
2. Run installer and select "Register Miniforge3 as my default Python 3.12"
3. After installation, search "Miniforge Prompt" in Windows Search Bar
4. When you re-open the terminal, notice you will see a prompt with `(base)` next to your path
5. Check Python installation is working via `python --version`

:::
:::

---

## Create conda environment from environment.yml

- There are several ways to initialize a conda environment

- The most reproducible and portable way is through a yaml file

- To create the conda environment we run the following:  
```{bash}
cd <project_directory>
conda env create -f environment.yml
```
---

## conda-lock (FYI)

- conda-lock generates reproducible platform-specific lockfiles from environment.yml
- Use when you need bit-for-bit reproducibility for deployment/CI

Commands (examples):

```
# generate locks for multiple platforms
conda-lock -f environment.yml -p linux-64 -p osx-64 -p win-64

# install from a lockfile (platform-specific)
conda-lock install --name myenv --file conda-lock.yml --platform linux-64
```

Notes:
- conda-lock is optional for workshop attendees; environment.yml is sufficient for development
- Generating cross-platform locks is best done in CI or on the maintainer's machine

---

## Python + reticulate: why this matters

- Once conda/Python is installed and RStudio points to the correct Python, you can run python chunks or call Python from R
- Useful libraries: pandas, matplotlib, seaborn

---

## Example reticulate snippet

```r
library(reticulate)
# use the conda env created above
reticulate::use_condaenv("workshop-dependency", required = TRUE)
py_config()

# import pandas
pd <- import("pandas")
df <- pd$DataFrame(list(x = c(1,2,3), y = c(4,5,6)))
print(df)
```

---

## Python chunk example (Quarto only)

In Quarto documents, you can use native Python chunks:

```python
# Example Python snippet
import pandas as pd
import matplotlib.pyplot as plt

pdf = pd.DataFrame({"x": [1,2,3,4], "y": [2,3,5,7]})
print(pdf.head())

plt.plot(pdf['x'], pdf['y'], marker='o')
plt.title('Python plot in Quarto')
plt.show()
```

Note: This works in Quarto (.qmd) but requires reticulate in R Markdown (.Rmd)

---

## Workflow: renv + conda + reticulate

![](images/workflow_diagram.jpeg)

---

## Troubleshooting checks (RStudio)

- In Terminal: `python --version` and `which python` (mac) or `where python` (windows)
- In R: `reticulate::py_config()` to inspect which Python R is using

---

## Resources

- renv: https://rstudio.github.io/renv/
- conda & mamba: https://docs.conda.io/ and https://mamba.readthedocs.io/
- conda-lock: https://conda.github.io/conda-lock/
- reticulate: https://rstudio.github.io/reticulate/

---

## Next steps

- Follow demo/demo.qmd locally in RStudio
- Generate renv.lock and conda-lock if you need archival/CI reproducibility

---
