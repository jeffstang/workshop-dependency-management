---
title: "Demo (Quarto): renv + conda with native Python chunks"
format: html
---

# Overview

This Quarto demo shows:
1. **renv** for R package management
2. **Native Python chunks** (no reticulate needed for execution)
3. **Reticulate** for R-to-Python interoperability

## R / renv section

```{r}
# Initialize renv for the project (run once)
if (!requireNamespace("renv", quietly = TRUE)) install.packages("renv")
# renv::init()  # uncomment to initialize in a live session

# Example R code (will run if packages are available)
library(ggplot2)
library(dplyr)

# small example dataset
x_vals <- rnorm(100)
df <- data.frame(x = x_vals, y = rnorm(100) + x_vals)

p <- ggplot(df, aes(x = x, y = y)) + geom_point() + geom_smooth(method = "lm")
print(p)

# After installing packages, run renv::snapshot() to record versions
# renv::snapshot()
```

---

## Python section (Native Quarto Python engine)

**Note:** Before rendering, activate your conda environment:
```bash
conda activate workshop-dependency
```

Quarto will automatically use Jupyter to execute Python chunks:

```{python}
# Example Python snippet (requires the conda env from environment.yml)
import pandas as pd
import matplotlib.pyplot as plt

pdf = pd.DataFrame({"x": [1,2,3,4], "y": [2,3,5,7]})
print(pdf.head())

plt.plot(pdf['x'], pdf['y'], marker='o')
plt.title('Simple Python plot from native Quarto chunk')
plt.show()
```

---

## Reticulate: R â†” Python interoperability

### Using Pre-existing Conda Environments with Reticulate

**Yes, reticulate can call and use pre-existing conda environments!** This is a key feature that allows you to:

1. **Reference any existing conda environment by name** using `use_condaenv()`
2. **Load that environment as the Python runtime** for your R session  
3. **Access all Python packages** installed in that conda environment
4. **Share data between R and Python** seamlessly

Use reticulate when you need to share objects between R and Python:

```{r}
library(reticulate)
# Point to the pre-existing conda env (adjust name if you changed it)
# This environment should already exist - created via: conda env create -f environment.yml
use_condaenv("workshop-dependency", required = TRUE)

# Show Python configuration - confirms we're using the conda environment
print(py_config())

# Import pandas and create a DataFrame from R
pd <- import("pandas")
py_df <- pd$DataFrame(list(a = c(1,2,3), b = c(4,5,6)))
print(py_df)

# Convert to R data.frame
r_df <- py_to_r(py_df)
print(class(r_df))
print(r_df)
```

**Note:** The conda environment "workshop-dependency" must already exist on your system. Create it first with:
```bash
conda env create -f environment.yml
```

---

## Notes for attendees

- **Quarto automatically detects chunk types** and uses the appropriate engine
- Python chunks run via Jupyter (no reticulate needed for execution)
- R chunks run via knitr
- Use reticulate only when you need to share data between R and Python
- **Reticulate CAN use pre-existing conda environments** - just provide the environment name
- Before rendering: `conda activate workshop-dependency && quarto render demo.qmd`

### FAQ: Using Pre-existing Conda Environments

**Q: Can reticulate use an existing conda environment I already created?**

**A: Yes!** Simply use `use_condaenv("your-env-name", required = TRUE)` where "your-env-name" is the name of any conda environment on your system. You can list available conda environments with:
```bash
conda env list
```
